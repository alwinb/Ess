<!DOCTYPE html>
<html>
<head>
	<title>REPL</title>
	<meta charset="utf-8"/>
	<script src="./ess.min.js"></script>
	<script src="./repl.js"></script>
	<style>

	/** svg styles for the bdds */

	path, .node {
		fill:none;
		stroke:black;
		stroke-width:1; }	

	path.false {
		stroke-dasharray:3,3; }

	.node {
		fill:white;
		stroke:black; }

	text {
		font-size:16.5;
		fill:black;
		text-anchor:middle;
		dominant-baseline:central;
		font-style:italic; }

	text.return, text.type {
		font-size:14.8;
		dominant-baseline:central;
		font-style:normal;
	}

  text.type {
		font-family:monospace;
  }

	#top text, #bot text {
		font-style:normal; }


	/** repl styles */

	.prompt, .input, .prompt input, .output {
		border:none;
		outline:none;
		margin:0;padding:0;
		width:95%; /* FIXME */
		font-family:monospace;
		font-size:16px;
		line-height:1.6em;
		white-space:pre;
		background:none;
		color:inherit;
	}
	.prompt::before, .input::before {
		content:'> ';
		white-space: nowrap;
	}
  .output.error { color:red;}

	</style>
</head>
<body>

<div id="repl">
</div>

<script>
const log = console.log.bind (console)
  
function main () {
  let store = new Ess.core.Store ()
	repl = new Repl (document.getElementById('repl'), _eval)
	  .exec ('name:"joe" & flag?:boolean')
	  .exec ('number | string')
	  .exec ('string | number | false') // FIXME
    .exec ('<1 & >2')

	window.onclick = repl.focus
	repl.focus()

  function _eval (input) {
		if (input === '.clear') {
			store = new Ess.core.Store ()
			return window.setTimeout (repl.clear, 0)
		}
		else try {
			var tm = Ess.core.parse (input)
			var svg = Ess.core.toSvg (store.trace (store.eval(tm)) .heap)
			return { type:'html_raw', value:svg }
		} catch (e) {
			//throw e
			return e//+ '\n'+e.stack
		}
	}
}
setTimeout (main,0)
</script>
</body>
</html>